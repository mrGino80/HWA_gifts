<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>HWA Gifts Codes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="manifest" href="manifest.json">
    <link
      href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-dark: #050510;
        --bg-dark-panel: #101020;
        --bg-light: #f4f4f8;
        --bg-light-panel: #ffffff;
        --text-dark: #e8e8ff;
        --text-light: #222233;
        --accent-blue: #29b6f6;
        --accent-purple: #ab47bc;
        --accent-soft-blue: #1976d2;
        --accent-soft-purple: #7b1fa2;
        --danger: #ff5252;
        --success: #66bb6a;
        --highlight-bg: rgba(41, 182, 246, 0.35); /* accent-blue soft neon */ 
        --highlight-opacity: 0.55;
        --shadow-neon: 0 0 12px rgba(41, 182, 246, 0.7),
          0 0 24px rgba(171, 71, 188, 0.5);
        --shadow-soft: 0 2px 6px rgba(0, 0, 0, 0.15);
      }

      body {
        margin: 0;
        padding: 16px;
        font-family: "Rajdhani", system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", sans-serif;
        background: radial-gradient(
          circle at top,
          #101030 0,
          #050510 45%,
          #000000 100%
        );
        color: var(--text-dark);
        min-height: 100vh;
        box-sizing: border-box;
      }

      body.light {
        background: radial-gradient(
          circle at top,
          #ffffff 0,
          #f4f4f8 45%,
          #e0e0f0 100%
        );
        color: var(--text-light);
        --highlight-bg: rgba(25, 118, 210, 0.25); /* accent-soft-blue */ 
        --highlight-opacity: 0.45;
      }

      h1 {
        text-align: center;
        font-size: 26px;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        margin: 4px 0 2px;
        color: var(--accent-blue);
        text-shadow: 0 0 8px rgba(41, 182, 246, 0.8);
      }

      h2 {
        font-size: 18px;
        margin: 18px 0 8px;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: var(--accent-purple);
      }

      .subtitle {
        text-align: center;
        font-size: 12px;
        letter-spacing: 0.18em;
        text-transform: uppercase;
        opacity: 0.7;
        margin-bottom: 12px;
      }

      .container {
        max-width: 520px;
        margin: 0 auto;
      }

      .panel {
        background: linear-gradient(
          135deg,
          rgba(16, 16, 32, 0.95),
          rgba(8, 8, 24, 0.98)
        );
        border-radius: 12px;
        padding: 14px;
        margin-top: 12px;
        box-shadow: var(--shadow-neon);
        border: 1px solid rgba(41, 182, 246, 0.4);
        position: relative;
        overflow: hidden;
      }

      body.light .panel {
        background: linear-gradient(135deg, #ffffff, #f4f4f8);
        box-shadow: var(--shadow-soft);
        border: 1px solid rgba(25, 118, 210, 0.3);
      }

      .panel::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
            circle at top left,
            rgba(41, 182, 246, 0.18),
            transparent 55%
          ),
          radial-gradient(
            circle at bottom right,
            rgba(171, 71, 188, 0.18),
            transparent 55%
          );
        opacity: 0.9;
        pointer-events: none;
      }

      .panel-inner {
        position: relative;
        z-index: 1;
      }

      .btn-row {
        display: flex;
        gap: 8px;
        margin-top: 8px;
        flex-wrap: wrap;
      }

      button {
        flex: 1;
        padding: 10px 12px;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        border-radius: 999px;
        border: 1px solid rgba(41, 182, 246, 0.7);
        background: radial-gradient(
          circle at top,
          #29b6f6 0,
          #0d47a1 60%,
          #000000 100%
        );
        color: #e8f8ff;
        cursor: pointer;
        box-shadow: 0 0 10px rgba(41, 182, 246, 0.7);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
      }

      button span.icon {
        font-size: 16px;
      }

      button.secondary {
        flex: 0 0 auto;
        padding: 8px 12px;
        font-size: 12px;
        background: radial-gradient(
          circle at top,
          #ab47bc 0,
          #4a148c 60%,
          #000000 100%
        );
        border-color: rgba(171, 71, 188, 0.7);
        box-shadow: 0 0 10px rgba(171, 71, 188, 0.7);
      }

      body.light button {
        background: linear-gradient(135deg, #29b6f6, #1976d2);
        box-shadow: var(--shadow-soft);
        border-color: rgba(25, 118, 210, 0.7);
        color: #fdfdfd;
      }

      body.light button.secondary {
        background: linear-gradient(135deg, #ab47bc, #7b1fa2);
        border-color: rgba(123, 31, 162, 0.7);
      }

      button:active {
        transform: translateY(1px) scale(0.99);
        box-shadow: 0 0 6px rgba(41, 182, 246, 0.5);
      }

      .status {
        font-size: 13px;
        opacity: 0.8;
        margin-top: 6px;
      }

      #results,
      #history {
        margin-top: 10px;
        padding: 10px;
        border-radius: 8px;
        background: rgba(5, 5, 20, 0.9);
        border: 1px solid rgba(41, 182, 246, 0.4);
        font-size: 14px;
        white-space: pre-line;
        max-height: 260px;
        overflow-y: auto;
      }

      body.light #results,
      body.light #history {
        background: #f9f9ff;
        border-color: rgba(25, 118, 210, 0.3);
      }

      .line-main {
        color: var(--accent-blue);
      }

      .line-sub {
        color: #c5cae9;
        font-size: 13px;
        margin-left: 8px;
      }

      body.light .line-sub {
        color: #3949ab;
      }

      .loading {
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .spinner {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        border: 2px solid rgba(41, 182, 246, 0.2);
        border-top-color: var(--accent-blue);
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .settings-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin: 4px 0;
        font-size: 13px;
      }

      .settings-row label {
        flex: 1;
      }

      .settings-row input[type="number"] {
        width: 70px;
        padding: 4px;
        border-radius: 6px;
        border: 1px solid rgba(41, 182, 246, 0.6);
        background: rgba(5, 5, 20, 0.9);
        color: var(--text-dark);
        font-family: inherit;
        font-size: 13px;
      }

      body.light .settings-row input[type="number"] {
        background: #ffffff;
        color: var(--text-light);
        border-color: rgba(25, 118, 210, 0.6);
      }

      .toggle {
        position: relative;
        width: 46px;
        height: 22px;
        border-radius: 999px;
        background: rgba(41, 182, 246, 0.3);
        border: 1px solid rgba(41, 182, 246, 0.7);
        cursor: pointer;
        flex-shrink: 0;
      }

      .toggle-knob {
        position: absolute;
        top: 1px;
        left: 1px;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #e8f8ff;
        box-shadow: 0 0 6px rgba(41, 182, 246, 0.8);
        transition: transform 0.18s ease-out;
      }

      .toggle.on {
        background: rgba(171, 71, 188, 0.4);
        border-color: rgba(171, 71, 188, 0.8);
      }

      .toggle.on .toggle-knob {
        transform: translateX(22px);
        box-shadow: 0 0 6px rgba(171, 71, 188, 0.8);
      }

      .tag {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 999px;
        border: 1px solid rgba(41, 182, 246, 0.6);
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        opacity: 0.8;
        margin-left: 4px;
      }

      .tag.light {
        border-color: rgba(25, 118, 210, 0.6);
      }

      .tag.history {
        border-color: rgba(171, 71, 188, 0.6);
      }

      .tag.gifts {
        border-color: rgba(102, 187, 106, 0.8);
      }

      .pull-hint {
        font-size: 11px;
        opacity: 0.6;
        margin-top: 4px;
      }

      a.link {
        color: var(--accent-blue);
        text-decoration: none;
        font-size: 11px;
        opacity: 0.8;
      }

      a.link:hover {
        text-decoration: underline;
      }
      .highlight {
        font-size: 1.2rem;
  background: linear-gradient(
    120deg,
    var(--highlight-bg) 0%,
    var(--highlight-bg) 100%
  );
  background-size: 100% var(--highlight-opacity);
  background-repeat: no-repeat;
  background-position: 0 70%;
  padding: 0 2px;
  border-radius: 2px;
}

    </style>
  </head>
  <body>
    <div class="container">
      <h1>HWA GIFTS CODES</h1>
      <div class="subtitle"></div>

      <!-- MAIN PANEL -->
      <div class="panel">
        <div class="panel-inner">
          <div class="settings-row">
            <div>
              <span style="font-size: 13px; opacity: 0.9">Live Codes</span>
              <span class="tag">AUTO REFRESH</span>
            </div>
            <a href="#" class="link" onclick="manualRefresh();return false;"
              >Force refresh</a
            >
          </div>

          <div class="btn-row">
            <button onclick="loadCodes()">
              <span class="icon">âš¡</span>
              <span>Refresh Codes</span>
            </button>
            <button class="secondary" onclick="copyCodes()">
              <span class="icon">ðŸ“‹</span>
              <span>Copy</span>
            </button>
          </div>

          <div class="status" id="statusText"></div>
          <div id="results">Initializingâ€¦</div>
          <div class="pull-hint">Pull down (swipe) to refresh on mobile.</div>
        </div>
      </div>

      <!-- SETTINGS PANEL -->
      <div class="panel">
        <div class="panel-inner">
          <div class="settings-row">
            <div>
              <span style="font-size: 13px; opacity: 0.9">Settings</span>
              <span class="tag light">CONFIG</span>
            </div>
          </div>

          <div class="settings-row">
            <label for="tablesInput">Tables to read</label>
            <input type="number" id="tablesInput" min="1" max="20" value="5" />
          </div>

          <div class="settings-row">
            <label>Auto refresh on open</label>
            <div class="toggle" id="toggleAuto" onclick="toggleSetting('auto')">
              <div class="toggle-knob"></div>
            </div>
          </div>

          <div class="settings-row">
            <label>Theme (Dark / Light)</label>
            <div
              class="toggle"
              id="toggleTheme"
              onclick="toggleSetting('theme')"
            >
              <div class="toggle-knob"></div>
            </div>
          </div>

          <div class="settings-row">
            <label>Save history</label>
            <div
              class="toggle"
              id="toggleHistory"
              onclick="toggleSetting('history')"
            >
              <div class="toggle-knob"></div>
            </div>
          </div>

          <div class="btn-row" style="margin-top: 10px">
            <button class="secondary" onclick="exportHistory()">
              <span class="icon">ðŸ’¾</span>
              <span>Export History</span>
            </button>
            <button class="secondary" onclick="clearHistory()">
              <span class="icon">ðŸ§¹</span>
              <span>Clear History</span>
            </button>
          </div>
        </div>
      </div>

      <!-- HISTORY PANEL -->
      <div class="panel">
        <div class="panel-inner">
          <div class="settings-row">
            <div>
              <span style="font-size: 13px; opacity: 0.9">History</span>
              <span class="tag history">LOCAL</span>
            </div>
          </div>
          <div id="history">No history yet.</div>
        </div>
      </div>
    </div>

    <script>
      if ("serviceWorker" in navigator) 
      { 
        console.log("sw");
        navigator.serviceWorker.register("./sw.js"); 
      }
      const STORAGE_KEY_SETTINGS = "ym_settings_v1";
      const STORAGE_KEY_HISTORY = "ym_history_v1";

      let settings = {
        tablesToRead: 5,
        autoRefresh: true,
        theme: "dark", // "dark" or "light"
        saveHistory: true,
      };

      function loadSettings() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY_SETTINGS);
          if (raw) {
            const parsed = JSON.parse(raw);
            settings = Object.assign(settings, parsed);
          }
        } catch (e) {
          console.warn("Settings load error", e);
        }

        document.getElementById("tablesInput").value = settings.tablesToRead;
        updateToggle("toggleAuto", settings.autoRefresh);
        updateToggle("toggleTheme", settings.theme === "light");
        updateToggle("toggleHistory", settings.saveHistory);
        applyTheme();
      }

      function saveSettings() {
        try {
          localStorage.setItem(STORAGE_KEY_SETTINGS, JSON.stringify(settings));
        } catch (e) {
          console.warn("Settings save error", e);
        }
      }

      function updateToggle(id, on) {
        const el = document.getElementById(id);
        if (!el) return;
        if (on) el.classList.add("on");
        else el.classList.remove("on");
      }

      function toggleSetting(type) {
        if (type === "auto") {
          settings.autoRefresh = !settings.autoRefresh;
          updateToggle("toggleAuto", settings.autoRefresh);
        } else if (type === "theme") {
          settings.theme = settings.theme === "dark" ? "light" : "dark";
          updateToggle("toggleTheme", settings.theme === "light");
          applyTheme();
        } else if (type === "history") {
          settings.saveHistory = !settings.saveHistory;
          updateToggle("toggleHistory", settings.saveHistory);
        }
        saveSettings();
      }

      function applyTheme() {
        if (settings.theme === "light") {
          document.body.classList.add("light");
        } else {
          document.body.classList.remove("light");
        }
      }

      function getHistory() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY_HISTORY);
          if (!raw) return [];
          return JSON.parse(raw);
        } catch (e) {
          console.warn("History load error", e);
          return [];
        }
      }

      function setHistory(list) {
        try {
          localStorage.setItem(STORAGE_KEY_HISTORY, JSON.stringify(list));
        } catch (e) {
          console.warn("History save error", e);
        }
      }

      function addToHistory(date, code, giftsText) {
        if (!settings.saveHistory) return;
        let history = getHistory();
        if (
          !history.some((entry) => entry.date === date && entry.code === code)
        ) {
          history.push({ date, code, gifts: giftsText || "" });
          history.sort((a, b) => new Date(b.date) - new Date(a.date));
          setHistory(history);
        }
      }

      function updateHistoryDisplay() {
        const box = document.getElementById("history");
        const history = getHistory();
        if (!history.length) {
          box.textContent = "No history yet.";
          return;
        }
        let lines = history.map((entry) => {
          let base = `${entry.date} â†’ ${entry.code}`;
          if (entry.gifts) {
            base += `\n  ${entry.gifts}`;
          }
          return base;
        });
        box.textContent = lines.join("\n\n");
      }

      async function loadCodes() {
        const output = document.getElementById("results");
        const status = document.getElementById("statusText");
        const tablesInput = document.getElementById("tablesInput");

        let tablesToRead = parseInt(tablesInput.value, 10);
        if (isNaN(tablesToRead) || tablesToRead < 1) tablesToRead = 1;
        if (tablesToRead > 20) tablesToRead = 20;
        settings.tablesToRead = tablesToRead;
        saveSettings();

        output.innerHTML = "";
        const loadingDiv = document.createElement("div");
        loadingDiv.className = "loading";
        loadingDiv.innerHTML =
          '<div class="spinner"></div><span>Fetching latest codesâ€¦</span>';
        output.appendChild(loadingDiv);
        status.textContent = "Contacting remote terminalâ€¦";

        const url = "https://alexandregames.com/y-m-gifts-hwa-en.html";
        const proxy =
          "https://api.allorigins.win/raw?url=" + encodeURIComponent(url);

        try {
          const html = await fetch(proxy).then((r) => r.text());
          const doc = new DOMParser().parseFromString(html, "text/html");

          const tables = doc.querySelectorAll("table");
          let results = [];

          for (let i = 0; i < tablesToRead; i++) {
            const table = tables[i];
            if (!table) {
              results.push(`Table ${i + 1}: not found`);
              continue;
            }

            const rows = table.querySelectorAll("tbody tr, tr");
            let found = null;
            let giftsText = "";

            for (const r of rows) {
              const dateCell = r.querySelector("td:nth-of-type(1)");
              const codeCell = r.querySelector("td:nth-of-type(2)");

              if (dateCell && codeCell) {
                const date = dateCell.textContent.trim();
                const code = codeCell.textContent.trim();

                if (/^\d+-\d+$/.test(code)) {
                  const giftCells = r.querySelectorAll("td:nth-of-type(n+3)");
                  let gifts = [];
                  giftCells.forEach((gc, idx) => {
                    const txt = gc.textContent.trim();
                    if (txt) {
                      gifts.push(`Gift ${idx + 1}: ${txt}`);
                    }
                  });
                  giftsText = gifts.join(" | ");
                  found = { date, code, giftsText };
                  addToHistory(date, code, giftsText);
                  break;
                }
              }
            }

            if (found) {
              let line = `${found.date} â†’ ${found.code}`;
              if (found.giftsText) {
                line += `\n  ${found.giftsText}`;
              }
              results.push(line);
            } else {
              results.push(`Table ${i + 1}: no code found`);
            }
          }

          output.innerHTML = results .map(line => line.replace(/(\d+-\d+)/g, "<span class='highlight'>$1</span>")) .join("<br><br>");
          status.textContent = "Last update: " + new Date().toLocaleString();
          updateHistoryDisplay();
        } catch (e) {
          console.error(e);
          output.textContent = "Error loading data.";
          status.textContent = "Connection error. Try again.";
        }
      }

      function manualRefresh() {
        loadCodes();
      }

      function copyCodes() {
        const text = document.getElementById("results").textContent;
        if (!text.trim()) {
          alert("No codes to copy yet.");
          return;
        }
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard
            .writeText(text)
            .then(() => {
              alert("Codes copied to clipboard.");
            })
            .catch(() => {
              fallbackCopy(text);
            });
        } else {
          fallbackCopy(text);
        }
      }

      function fallbackCopy(text) {
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        try {
          document.execCommand("copy");
          alert("Codes copied to clipboard.");
        } catch (e) {
          alert("Unable to copy automatically.");
        }
        document.body.removeChild(ta);
      }

      function exportHistory() {
        const history = getHistory();
        if (!history.length) {
          alert("No history to export.");
          return;
        }
        let lines = history.map((entry) => {
          let base = `${entry.date} â†’ ${entry.code}`;
          if (entry.gifts) base += ` | ${entry.gifts}`;
          return base;
        });
        const blob = new Blob([lines.join("\n")], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "ym_gifts_history.txt";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      function clearHistory() {
        if (!confirm("Clear all saved history?")) return;
        setHistory([]);
        updateHistoryDisplay();
      }

      let touchStartY = null;
      let touchActive = false;

      window.addEventListener(
        "touchstart",
        (e) => {
          if (window.scrollY === 0) {
            touchStartY = e.touches[0].clientY;
            touchActive = true;
          } else {
            touchActive = false;
          }
        },
        { passive: true }
      );

      window.addEventListener(
        "touchmove",
        (e) => {
          if (!touchActive || touchStartY === null) return;
          const currentY = e.touches[0].clientY;
          const diff = currentY - touchStartY;
          if (diff > 80) {
            touchActive = false;
            loadCodes();
          }
        },
        { passive: true }
      );

      window.addEventListener("touchend", () => {
        touchStartY = null;
        touchActive = false;
      });

      window.onload = () => {
        loadSettings();
        updateHistoryDisplay();
        if (settings.autoRefresh) {
          loadCodes();
        } else {
          document.getElementById("results").textContent =
            "Press REFRESH CODES to fetch the latest data.";
          document.getElementById("statusText").textContent =
            "Auto refresh is disabled in settings.";
        }
      };
    </script>
  </body>
</html>








